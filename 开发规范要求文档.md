# 智能体服务平台开发规范要求文档

## 1. 代码注释标准（强制执行）

### 1.1 文件级头部注释

**所有源代码文件必须包含以下头部注释**：

#### 1.1.1 前端文件注释模板

```typescript
/**
 * [文件概览]
 * - 目的: 用户认证相关的状态管理和业务逻辑
 * - 数据流: LoginForm → authStore → API → JWT Token → 全局状态
 * - 核心数据: { user: UserInfo, token: string, isAuthenticated: boolean }
 * - 关系: @/api/auth.ts → 认证API调用
 *         @/router/index.ts → 路由守卫
 *         @/components/LoginForm.vue → 登录表单组件
 */
```

#### 1.1.2 后端文件注释模板

```java
/**
 * [文件概览]
 * - 目的: 用户认证服务，处理登录注册和JWT令牌管理
 * - 数据流: Controller → Service → Repository → Database
 * - 核心数据: User实体、JWT令牌、认证状态
 * - 关系: UserController.java → HTTP请求处理
 *         UserRepository.java → 数据访问层
 *         SecurityConfig.java → 安全配置
 */
```

### 1.2 函数级注释标准

**每个函数必须包含以下注释**：

#### 1.2.1 前端函数注释模板

```typescript
/**
 * [函数: loginUser]
 * - 输入: { email: string, password: string, rememberMe?: boolean }
 * - 输出: Promise<{ user: UserInfo, token: string }>
 * - 角色: 用户认证流程的入口点，连接表单数据与API调用
 * - 逻辑: 1. 验证输入参数格式
 *        2. 调用认证API接口
 *        3. 存储JWT令牌到localStorage
 *        4. 更新全局认证状态
 *        5. 重定向到目标页面
 */
async function loginUser(credentials: LoginCredentials): Promise<AuthResult> {
  // 实现代码...
}
```

#### 1.2.2 后端函数注释模板

```java
/**
 * [函数: authenticateUser]
 * - 输入: LoginRequest { email: String, password: String }
 * - 输出: ResponseEntity<AuthResponse>
 * - 角色: 处理用户登录请求，验证凭据并生成JWT令牌
 * - 逻辑: 1. 验证邮箱和密码格式
 *        2. 查询用户信息并验证密码
 *        3. 生成JWT访问令牌和刷新令牌
 *        4. 记录登录日志
 *        5. 返回用户信息和令牌
 */
@PostMapping("/login")
public ResponseEntity<AuthResponse> authenticateUser(@RequestBody LoginRequest request) {
    // 实现代码...
}
```

### 1.3 数据流向示意图注释

**复杂业务逻辑必须包含数据流向图**：

```typescript
/**
 * [数据流向示意图]
 * 
 * 智能体对话流程：
 * 
 * UserInput → Playground组件 → chatStore.sendMessage()
 *     ↓
 * API调用 → /api/agents/{id}/chat
 *     ↓
 * AgentService.processMessage() → AIGents API
 *     ↓
 * 响应处理 → 缓存到Redis → 返回前端
 *     ↓
 * 更新对话历史 → 显示在UI
 * 
 * 关键数据结构：
 * - Message: { id, content, role, timestamp, agentId }
 * - ChatSession: { id, messages[], agentId, userId }
 * - AgentConfig: { id, name, model, dataset, memory }
 */
```

### 1.4 设计思想说明注释

**业务逻辑实现必须说明设计思想**：

```java
/**
 * [设计思想说明]
 * 
 * 智能体实例管理采用工厂模式 + 策略模式：
 * 
 * 1. 工厂模式：AgentFactory根据配置创建不同类型的智能体实例
 *    - 避免在业务代码中硬编码智能体类型
 *    - 支持动态扩展新的智能体类型
 * 
 * 2. 策略模式：不同的MCP模型使用不同的处理策略
 *    - MCPStrategy接口定义统一的处理方法
 *    - AIGentsStrategy等具体实现
 * 
 * 3. 缓存策略：智能体配置缓存在Redis中
 *    - 减少数据库查询压力
 *    - 支持配置热更新
 * 
 * 4. 异常处理：采用统一的异常处理机制
 *    - 业务异常：AgentException
 *    - 系统异常：SystemException
 *    - 外部服务异常：ExternalServiceException
 */
```

### 1.5 注释质量检查规则

**强制执行的注释检查**：

1. **完整性检查**：
   - 所有public方法必须有完整注释
   - 所有文件必须有头部注释
   - 复杂业务逻辑必须有设计思想说明

2. **准确性检查**：
   - 注释内容必须与代码实现一致
   - 数据结构描述必须准确
   - 数据流向必须正确

3. **可读性检查**：
   - 使用中文注释，表达清晰
   - 避免过于技术化的术语
   - 注释格式统一规范

## 2. 接口文档规范

### 2.1 Swagger/OpenAPI 3.0 规范

#### 2.1.1 接口注解标准

```java
@RestController
@RequestMapping("/api/v1/agents")
@Api(tags = "智能体管理", description = "智能体实例的创建、配置和管理")
public class AgentController {

    @PostMapping
    @ApiOperation(
        value = "创建智能体实例",
        notes = "根据用户配置创建新的智能体实例，支持绑定数据集和MCP模型"
    )
    @ApiResponses({
        @ApiResponse(code = 200, message = "创建成功", response = AgentResponse.class),
        @ApiResponse(code = 400, message = "参数错误", response = ErrorResponse.class),
        @ApiResponse(code = 401, message = "未授权", response = ErrorResponse.class),
        @ApiResponse(code = 500, message = "服务器错误", response = ErrorResponse.class)
    })
    public ResponseEntity<AgentResponse> createAgent(
        @ApiParam(value = "智能体创建请求", required = true)
        @Valid @RequestBody CreateAgentRequest request,
        
        @ApiParam(value = "用户认证令牌", required = true)
        @RequestHeader("Authorization") String token
    ) {
        // 实现代码...
    }
}
```

#### 2.1.2 数据模型注解

```java
@ApiModel(description = "智能体创建请求")
public class CreateAgentRequest {
    
    @ApiModelProperty(
        value = "智能体名称",
        required = true,
        example = "客服助手",
        notes = "长度限制：2-50个字符"
    )
    @NotBlank(message = "智能体名称不能为空")
    @Length(min = 2, max = 50, message = "智能体名称长度必须在2-50个字符之间")
    private String name;
    
    @ApiModelProperty(
        value = "智能体描述",
        required = false,
        example = "专业的客服智能体，能够处理常见问题咨询",
        notes = "长度限制：最多500个字符"
    )
    @Length(max = 500, message = "描述长度不能超过500个字符")
    private String description;
    
    @ApiModelProperty(
        value = "绑定的数据集ID",
        required = false,
        example = "dataset_123456",
        notes = "可选，用于RAG增强"
    )
    private String datasetId;
    
    @ApiModelProperty(
        value = "MCP模型配置",
        required = true,
        notes = "智能体使用的模型配置信息"
    )
    @Valid
    @NotNull(message = "MCP配置不能为空")
    private MCPConfig mcpConfig;
}
```

### 2.2 接口文档组织结构

```
API文档结构
├── 概述
│   ├── 系统架构说明
│   ├── 认证授权机制
│   └── 通用响应格式
├── 用户服务层API
│   ├── 用户认证接口
│   ├── 用户信息管理
│   ├── 订阅服务接口
│   └── API密钥管理
├── 智能体服务层API
│   ├── 智能体管理接口
│   ├── 对话交互接口
│   ├── MCP配置接口
│   └── 记忆功能接口
├── 数据管理层API
│   ├── 数据集管理接口
│   ├── 文件上传接口
│   └── 数据处理状态
├── 市场交易层API
│   ├── MCP市场接口
│   ├── 模型购买接口
│   └── 订单管理接口
└── 系统管理层API
    ├── 系统监控接口
    ├── 用户管理接口
    └── 配置管理接口
```

### 2.3 接口文档质量要求

1. **完整性要求**：
   - 所有公开接口必须有文档
   - 包含请求参数、响应格式、错误码
   - 提供真实的示例数据

2. **准确性要求**：
   - 文档与实际接口保持同步
   - 参数类型和约束准确
   - 响应格式与实际一致

3. **可用性要求**：
   - 支持在线测试
   - 提供SDK和代码示例
   - 包含常见问题解答

## 3. 版本控制流程

### 3.1 Git 分支策略

#### 3.1.1 分支模型

```
Git分支结构
├── main (生产分支)
│   └── 只接受来自release分支的合并
├── develop (开发分支)
│   └── 日常开发的主分支
├── feature/* (功能分支)
│   ├── feature/user-auth
│   ├── feature/agent-playground
│   └── feature/data-management
├── release/* (发布分支)
│   ├── release/v1.0.0
│   └── release/v1.1.0
└── hotfix/* (热修复分支)
    └── hotfix/critical-bug-fix
```

#### 3.1.2 分支命名规范

**功能分支**：
- `feature/模块名-功能描述`
- 示例：`feature/user-auth`, `feature/agent-playground`

**发布分支**：
- `release/版本号`
- 示例：`release/v1.0.0`, `release/v1.1.0`

**热修复分支**：
- `hotfix/问题描述`
- 示例：`hotfix/login-error`, `hotfix/api-timeout`

### 3.2 提交信息规范

#### 3.2.1 提交信息格式

```
<类型>(<范围>): <描述>

<详细说明>

<关联问题>
```

#### 3.2.2 提交类型

- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档更新
- `style`: 代码格式调整
- `refactor`: 代码重构
- `test`: 测试相关
- `chore`: 构建过程或辅助工具的变动

#### 3.2.3 提交示例

```bash
# 功能提交
feat(auth): 实现JWT认证机制

- 添加JWT令牌生成和验证
- 实现用户登录状态管理
- 集成Spring Security配置

Closes #123

# 修复提交
fix(api): 修复智能体创建接口参数验证问题

- 修复MCPConfig验证逻辑
- 添加参数非空检查
- 优化错误信息提示

Fixes #456
```

### 3.3 代码审查流程

#### 3.3.1 Pull Request 规范

**PR标题格式**：
```
[类型] 功能描述 (#Issue号)
```

**PR描述模板**：
```markdown
## 变更说明
- [ ] 新功能开发
- [ ] Bug修复
- [ ] 代码重构
- [ ] 文档更新

## 功能描述
简要描述本次变更的功能和目的

## 技术实现
- 核心技术方案
- 关键代码变更
- 数据库变更（如有）

## 测试说明
- [ ] 单元测试通过
- [ ] 集成测试通过
- [ ] 手动测试完成

## 关联问题
Closes #123
Related to #456

## 截图（如适用）
功能截图或测试结果
```

#### 3.3.2 代码审查检查清单

**功能性检查**：
- [ ] 功能实现符合需求
- [ ] 边界条件处理正确
- [ ] 错误处理完善
- [ ] 性能影响可接受

**代码质量检查**：
- [ ] 代码注释完整准确
- [ ] 命名规范清晰
- [ ] 代码结构合理
- [ ] 无重复代码

**安全性检查**：
- [ ] 输入验证充分
- [ ] 权限控制正确
- [ ] 敏感信息保护
- [ ] SQL注入防护

**测试覆盖检查**：
- [ ] 单元测试覆盖率 > 80%
- [ ] 关键路径测试完整
- [ ] 异常场景测试

### 3.4 发布流程

#### 3.4.1 版本号规范

采用语义化版本控制（SemVer）：
- `主版本号.次版本号.修订号`
- 示例：`1.0.0`, `1.1.0`, `1.1.1`

**版本递增规则**：
- 主版本号：不兼容的API修改
- 次版本号：向下兼容的功能性新增
- 修订号：向下兼容的问题修正

#### 3.4.2 发布检查清单

**代码质量检查**：
- [ ] 所有测试通过
- [ ] 代码审查完成
- [ ] 静态代码分析通过
- [ ] 安全扫描通过

**文档更新**：
- [ ] API文档更新
- [ ] 用户手册更新
- [ ] 变更日志更新
- [ ] 部署文档更新

**环境验证**：
- [ ] 开发环境测试通过
- [ ] 测试环境验证通过
- [ ] 预生产环境验证
- [ ] 性能测试通过

## 4. 代码质量保证

### 4.1 静态代码分析

#### 4.1.1 前端代码检查

**ESLint配置**：
```json
{
  "extends": [
    "@vue/typescript/recommended",
    "@vue/prettier",
    "@vue/prettier/@typescript-eslint"
  ],
  "rules": {
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/explicit-function-return-type": "warn",
    "vue/component-name-in-template-casing": ["error", "PascalCase"],
    "vue/no-unused-components": "error"
  }
}
```

**Prettier配置**：
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2
}
```

#### 4.1.2 后端代码检查

**Checkstyle配置**：
- 强制使用统一的代码格式
- 检查命名规范
- 验证注释完整性

**SpotBugs配置**：
- 检测潜在的bug
- 性能问题识别
- 安全漏洞扫描

### 4.2 自动化测试

#### 4.2.1 单元测试要求

**覆盖率要求**：
- 整体覆盖率 > 80%
- 核心业务逻辑覆盖率 > 90%
- 新增代码覆盖率 > 85%

**测试命名规范**：
```java
// 方法名格式：should_期望结果_when_测试条件
@Test
void should_ReturnUserInfo_when_ValidTokenProvided() {
    // 测试实现
}

@Test
void should_ThrowException_when_InvalidTokenProvided() {
    // 测试实现
}
```

#### 4.2.2 集成测试要求

**API测试**：
- 所有公开接口必须有集成测试
- 测试正常流程和异常流程
- 验证数据库事务正确性

**端到端测试**：
- 关键用户流程测试
- 跨模块功能测试
- 性能基准测试

### 4.3 持续集成配置

#### 4.3.1 CI/CD流水线

```yaml
# .gitlab-ci.yml
stages:
  - lint
  - test
  - build
  - deploy

lint-frontend:
  stage: lint
  script:
    - npm run lint
    - npm run type-check

lint-backend:
  stage: lint
  script:
    - mvn checkstyle:check
    - mvn spotbugs:check

test-frontend:
  stage: test
  script:
    - npm run test:unit
    - npm run test:e2e
  coverage: '/Lines\s*:\s*(\d+\.?\d*)%/'

test-backend:
  stage: test
  script:
    - mvn test
    - mvn jacoco:report
  coverage: '/Total.*?([0-9]{1,3})%/'

build:
  stage: build
  script:
    - npm run build
    - mvn package
  artifacts:
    paths:
      - dist/
      - target/*.jar

deploy-staging:
  stage: deploy
  script:
    - docker build -t app:$CI_COMMIT_SHA .
    - docker push registry/app:$CI_COMMIT_SHA
  only:
    - develop

deploy-production:
  stage: deploy
  script:
    - docker build -t app:$CI_COMMIT_SHA .
    - docker push registry/app:$CI_COMMIT_SHA
  only:
    - main
  when: manual
```

## 5. 文档管理规范

### 5.1 技术文档结构

```
文档目录结构
├── README.md (项目概述)
├── docs/
│   ├── api/ (接口文档)
│   │   ├── user-service.md
│   │   ├── agent-service.md
│   │   └── data-service.md
│   ├── architecture/ (架构文档)
│   │   ├── system-design.md
│   │   ├── database-design.md
│   │   └── security-design.md
│   ├── development/ (开发文档)
│   │   ├── setup-guide.md
│   │   ├── coding-standards.md
│   │   └── testing-guide.md
│   └── deployment/ (部署文档)
│       ├── environment-setup.md
│       ├── deployment-guide.md
│       └── monitoring-guide.md
└── CHANGELOG.md (变更日志)
```

### 5.2 文档更新流程

1. **同步更新**：代码变更时必须同步更新相关文档
2. **审查机制**：文档变更需要经过技术负责人审查
3. **版本控制**：文档与代码使用相同的版本控制流程
4. **定期检查**：每月进行文档准确性检查

---

**文档版本**：v1.0  
**创建日期**：2024-01-15  
**更新日期**：2024-01-15  
**负责人**：开发团队